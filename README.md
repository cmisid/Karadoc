# Karadoc :hamburger:

:movie_camera: :sound: :page_facing_up: A tool of few of us built to tag videos from the [MediaEval Challenge](http://www.multimediaeval.org/).

<p align="center">
  <a href="https://travis-ci.org/cmisid/Karadoc">
    <img alt="Build Status" src="https://travis-ci.org/cmisid/Karadoc.svg?branch=master">
  </a>
</p>

<p align="center">
	<img alt="cover" src="img/cover.png">
</p>

# Table of contents

<!-- Table of Contents generated by [gotoc](https://github.com/Belekkk/gotoc) -->
**Table of Contents** (by [`gotoc`](https://github.com/Belekkk/gotoc))
- [Karadoc :hamburger:](#karadoc-hamburger)
- [Table of contents ](#table-of-contents)
- [Installation](#installation)
  - [Updating to the latest version of Anaconda](#updating-to-the-latest-version-of-anaconda)
- [Linux and Mac OS X](#linux-and-mac-os-x)
- [Windows](#windows)
  - [Dependencies](#dependencies)
  - [Install OpenCV3](#install-opencv)
  - [Install required NLTK corpuses](#install-required-nltk-corpuses)
  - [Install Tesseract-OCR](#install-tesseract-ocr)
    - [OS X](#os-x)
    - [Linux platforms](#linux-platforms)
    - [Python library](#python-library)
- [Architecture](#architecture)
  - [Preprocessing](#preprocessing)
  - [Notebooks](#notebooks)
  - [Minibatch processing](#minibatch-processing)
- [Usage](#usage)
  - [Makefile commands](#makefile-commands)

# Installation

## Updating to the latest version of Anaconda

1. Install the release version of [`Anaconda`](https://www.continuum.io/downloads).
2. Follow the instructions below.

Create a new virtual environment:

```sh
conda create -n karadoc numpy scipy scikit-learn matplotlib python=3
```

Then, launch it with:

```sh
# Linux and Mac OS X
$ source activate karadoc
# Windows
$ activate karadoc
```


## Dependencies

Install python dependencies with:

```sh
$ pip install -r setup/requirements.txt
```


## Install OpenCV3

Since you are inside the virtual env, you can install OpenCV (Open Source library for Computer Vision):

```sh
$ conda install -c https://conda.binstar.org/menpo opencv3
```

You can then test if `opencv3` is correctly by typing the following command:

```sh
$ python -c "import cv2; print(cv2.__version__)"
>>> 3.1.0
```


## Install required NLTK corpuses

First, make sure NLTK is correctly installed.

```sh
$ python -c "import nltk; print(nltk.__version__)"
>>> 3.1
```

For certain tasks, NLTK requires extra data (ie. stop words). Running the following command will install the necessary data for lemmatization:

```sh
$ python -m nltk.downloader wordnet
```

## Install Tesseract-OCR


### OS X
Install __ImageMagick__ for image conversion:
```sh
$ brew install imagemagick
```

Install __tesseract__ for OCR:
```sh
$ brew install tesseract --with-all-languages
```

### Linux platforms

```sh
$ sudo apt-get install tesseract-ocr
$ sudo apt-get install tesseract-ocr-eng
```

### Python library

Then, install [`pytesseract`](https://github.com/madmaze/pytesseract):
```sh
$ pip install pytesseract
```

Sample example :

```python
import pytesseract
from PIL import Image

image_path = 'data/shots/Anglicantv-FCA2009ArchbishopVenables921/00371.jpg'

text = pytesseract.image_to_string(Image.open(image_path))
print(text)
```

# Architecture

![modules](https://docs.google.com/drawings/d/1A56i6HXJhikkHOtVfNO4qoF10zZ_d4SD5ztqsPuY-EA/pub?w=1094&h=1026)

## Preprocessing

We built a preprocessing tool for extracting raw data from the various media files that are available. The tool outputs CSV files into the `features/` folder which can be accessed for statistical analysis. The CSV files that we can extract are versionned so you can use them yourself.

## Notebooks

Some analytics notebooks are available in the `notebooks/` directory. To edit them, you just need to do:

```sh
$ jupyter notebook notebooks/
```

## Minibatch processing

![minibatchs](https://docs.google.com/drawings/d/1iAOM0KxzRnVMzs1XhLfxYdepDBjDmu3OimwHH7BBO5I/pub?w=960&h=846)

# Usage

## Makefile commands

```sh
$ make help
```

```
install                        install dependencies
help                           print this message
install-dev                    install dev-dependencies
test                           launch test suite
tasks                          grep TODO and FIXME project-wide
notebooks                      launch jupyter notebooks
```
